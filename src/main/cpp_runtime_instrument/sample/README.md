## runtime-анализ C++

Небольшой пример использования этого инструмента. Сам "проект", который тут является объектом изучения абстрактный и бесполезный. Инструменты для получения данных в директории `CodeRanking`

### Сборка 

Необходимо собрать проект с помощью компилятора, поддерживающего инструментирование (gcc, clang, ...) и добавить флаги `-g` и `-finstrument-functions`. Кроме того, лучше добавить `-finstrument-functions-exclude-file-list=/usr/include` (или другой путь в зависимости от устройства) для отключения последующей трассировки STL функций. Кроме того, на стадии линковки должен быть добавлен объектный файл, собраный из `CodeRanking/cr_instrument.cpp`. Можно посмотреть на примере `old_Makefile` (как бы Makefile самого проекта) и `Makefile` (способ сборки для получения данных для анализа). 

В этом примере достаточно просто выполнить `make`

### Запуск

Запускать исполняемый файл нужно как и при обычной сборке, в этом случае, например, `./main 42`. Будет получен файл с именем вида `trace_<число>`, изменив файл `cr_instruments.cpp` и пересобрав проект, можно получить то название, которое кажется удобнее.

В репозитории есть полученный таким образом файл `trace_138778`

### Обработка результата трассировки

Программа `CodeRanking/parse_trace` обрабатывает полученную трассировку. Нужно передать имена исполняемого файла, файла с трассировкой, а также можно указать флаг `-f` для получения расположений функций в финальных данных. 

В этом примере ` CodeRanking/parse_trace -e main -t trace_138778` даёт такой результат

```
bar(unsigned long)
        1 call(s) from main

foo(unsigned long)
        1 call(s) from bar(unsigned long)

add1bil(unsigned long&)
        1 call(s) from foo(unsigned long)

add1mil(unsigned long&)
        1000 call(s) from add1bil(unsigned long&)
        1 call(s) from foo(unsigned long)

drop(unsigned long&)
        1 call(s) from bar(unsigned long)
        58823 call(s) from drop(unsigned long&)
```